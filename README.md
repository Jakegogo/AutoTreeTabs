# Auto Tree Tabs - Chrome 插件

一个类似 Tabs Outliner 的 Chrome 插件，能够跟踪用户点击链接并生成标签页树结构。

好消息，插件已经上架到Chrome扩展商店了:
[AutoTreeTabs](https://chromewebstore.google.com/detail/autotreetabs/lfifcpdmlbpoaflbgdmehnpkcipginaj)

## 🌟 亮点设计

### 💡 **核心创新**
- **🔗 智能链接追踪**: 全自动建立标签页父子关系，无需手动整理
- **🌲 可视化树形管理**: 直观展示浏览路径，让信息组织一目了然  
- **⚡ 一键批量操作**: 选中父节点即可批量管理所有相关标签页

### 🎯 **用户价值**
- **📚 效率提升**: 自动整理调研过程中的网页层级关系
- **🧹 标签页清理**: 智能级联关闭，避免标签页混乱和孤立
- **💾 会话记忆**: 跨浏览器会话保持标签页关系，研究工作不中断

### 🔒 **隐私安全**
- **🏠 本地存储**: 所有数据仅存储在本地，零网络传输
- **🛡️ 最小权限**: 仅申请必要的Chrome API权限
- **🔐 数据隔离**: 不同设备间数据独立，保护隐私安全

### ⚙️ **技术优势**
- **🚀 Manifest V3**: 采用最新Chrome扩展标准，性能和安全性更佳
- **🎨 主题适配**: 高对比度图标设计，完美适配浅色/深色主题
- **🔄 实时同步**: 异步处理标签页变化，不影响浏览器性能

### 🎪 **使用场景**
- **🎓 学术研究**: 跟踪论文引用链，整理研究资料
- **💼 项目管理**: 按项目组织相关网页和文档
- **🛒 购物比价**: 自动整理商品页面和比价信息
- **📖 知识学习**: 构建知识图谱，串联学习路径

## 🚀 快速预览

### **工作原理**
```
1. 用户点击链接 → 2. 自动建立父子关系 → 3. 树形结构展示 → 4. 一键批量管理
    🖱️ 点击           🔗 智能追踪         🌲 可视化        ⚡ 高效操作
```

### **核心优势对比**
| 特性 | Auto Tree Tabs | 传统标签页管理 |
|------|----------------|----------------|
| 关系建立 | ✅ 全自动追踪 | ❌ 手动整理 |
| 层级展示 | ✅ 树形可视化 | ❌ 平铺列表 |
| 批量操作 | ✅ 一键选择 | ❌ 逐个点击 |
| 会话保持 | ✅ 自动记忆 | ❌ 重新组织 |
| 隐私保护 | ✅ 本地存储 | ⚠️ 云端同步 |

## 功能特性

### 🔗 **链接跟踪与关系建立**
1. **智能链接跟踪**: 自动跟踪用户点击链接的行为，建立标签页之间的父子关系
   - 支持新标签页打开 (`target="_blank"`)
   - 支持快捷键打开 (Ctrl+点击 / Cmd+点击)
   - 支持中键点击打开
   - 支持右键菜单"在新标签页中打开"

2. **实时关系维护**: 动态监听标签页的创建、关闭和切换事件
   - 自动建立父子关系
   - 实时更新标签页状态
   - 支持跨域链接跟踪

### 🌲 **树形结构展示**
3. **可视化树形界面**: 在弹出窗口中以直观的树形结构显示所有标签页
   - 清晰的层级缩进显示
   - 父子关系可视化
   - 实时同步标签页状态

4. **智能节点展示**: 每个节点显示丰富的标签页信息
   - 网页标题和图标
   - URL域名显示
   - 活动状态指示
   - 加载状态反馈

### 🎯 **交互与操作**
5. **批量选择功能**: 点击父节点可以选中自身和所有子标签页
   - 递归选择所有子节点
   - 视觉反馈选中状态
   - 支持多选操作

6. **快速关闭功能**: 每个树节点都有关闭按钮，支持一键关闭
   - 单个标签页关闭
   - 批量关闭选中标签页
   - 关闭确认机制

7. **级联关闭功能**: 关闭父节点时会同时关闭所有子节点
   - 智能级联关闭
   - 防止孤立标签页
   - 操作撤销提示

### ⚡ **性能与体验**
8. **数据持久化**: 使用Chrome Storage API保存标签页关系
   - 跨会话数据保持
   - 快速数据恢复
   - 本地存储优化

9. **实时刷新**: 自动同步标签页变化，保持数据最新
   - 手动刷新按钮
   - 自动状态更新
   - 性能优化处理

10. **响应式设计**: 适配不同屏幕尺寸和用户偏好
    - 弹窗大小自适应
    - 深色/浅色主题兼容
    - 高对比度图标设计

### 🛡️ **安全与兼容性**
11. **权限控制**: 最小化权限要求，保护用户隐私
    - 仅请求必要权限
    - 本地数据存储
    - 无网络数据传输

12. **跨平台支持**: 支持所有Chrome支持的操作系统
    - Windows 兼容
    - macOS 兼容  
    - Linux 兼容

13. **Manifest V3兼容**: 采用最新的Chrome扩展标准
    - 现代化架构设计
    - 更好的安全性
    - 长期维护支持

## 安装步骤

### 开发者模式安装

1. 打开 Chrome 浏览器
2. 在地址栏输入 `chrome://extensions/` 并回车
3. 在右上角启用"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择本项目的文件夹
6. 插件安装完成

## 使用方法

### 🚀 **快速开始**

1. **启动插件**: 点击浏览器工具栏中的 Auto Tree Tabs 图标
2. **查看树结构**: 弹出窗口会显示当前所有标签页的层级关系
3. **刷新数据**: 点击"Refresh"按钮手动更新树结构
4. **开始浏览**: 正常浏览网页，插件会自动跟踪链接关系

### 🌳 **树形操作详解**

#### **节点选择**
- **单选**: 点击节点标题选择单个标签页，自动切换到该页面
- **多选**: 点击父节点可同时选中所有子标签页
- **递归选择**: 选择操作会递归应用到所有子孙节点
- **视觉反馈**: 选中的节点会高亮显示

#### **标签页管理**
- **快速切换**: 点击任意节点标题即可切换到对应标签页
- **单个关闭**: 点击节点右侧的红色 × 按钮关闭单个标签页
- **批量关闭**: 选中多个节点后批量关闭
- **级联关闭**: 关闭父节点时自动关闭所有子节点，避免孤立标签页

#### **界面交互**
- **展开/折叠**: 点击节点前的箭头图标展开或折叠子树
- **拖拽排序**: 支持拖拽调整节点顺序（计划功能）
- **搜索过滤**: 快速搜索特定标签页（计划功能）

### 🔍 **自动跟踪机制**

插件智能识别并跟踪以下链接打开行为：

#### **支持的打开方式**
- **新标签链接**: 点击带有 `target="_blank"` 属性的链接
- **快捷键打开**: 
  - Windows/Linux: `Ctrl + 点击`
  - macOS: `Cmd + 点击`
- **中键点击**: 使用鼠标中键点击链接
- **右键菜单**: 右键选择"在新标签页中打开链接"
- **地址栏导航**: 在新标签页中直接输入网址

#### **智能关系建立**
- **同域优先**: 优先建立同域名下的页面关系
- **引用关系**: 基于HTTP Referer建立父子关系
- **时间关联**: 基于打开时间的相近性判断关系
- **用户行为**: 结合用户的点击路径分析关系

### 💡 **使用技巧**

#### **高效浏览**
1. **项目管理**: 为不同项目打开独立的根标签页
2. **资料整理**: 利用树形结构整理相关资料
3. **研究工作**: 跟踪调研过程中的页面关系
4. **购物比较**: 整理商品页面和比价信息

#### **快捷操作**
1. **快速清理**: 选中某个主题的根节点，一键清理相关标签页
2. **会话保存**: 关闭浏览器前，树形关系会自动保存
3. **性能优化**: 定期清理不需要的标签页，保持浏览器流畅

## 文件结构

```
AutoTreeTabs/
├── manifest.json       # 插件配置文件
├── popup.html          # 弹出窗口HTML
├── popup.js            # 弹出窗口逻辑
├── background.js       # 后台服务脚本
├── content.js          # 内容脚本
├── icons/              # 图标文件夹
│   ├── icon.svg        # 原始SVG图标
│   ├── icon.png        # 16x16 PNG图标
│   └── icon16.png      # 16x16 PNG图标(备份)
├── store-assets/       # 商店发布资源
│   ├── screenshots/    # 功能截图目录
│   │   ├── chrome-store/    # Chrome商店官方截图
│   │   ├── readme-docs/     # README文档截图
│   │   └── development/     # 开发过程截图
│   └── *.md           # 发布指南和说明文档
├── package-extension.sh # 打包脚本
└── README.md           # 说明文档
```

## 图标设计

### 主题适配

Chrome扩展的图标主题适配存在以下限制和解决方案：

#### **限制说明**
- Chrome扩展的PNG图标**无法自动适配**浅色/深色主题
- 这是Chrome浏览器的原生限制，不是插件问题

#### **当前解决方案**
本插件采用**高对比度设计**策略：

1. **双层设计**：
   - 外层：白色边框（深色主题下可见）
   - 内层：深蓝色背景（浅色主题下突出）
   - 文字：白色字母A（两种主题下都清晰）

2. **视觉效果**：
   - ✅ 浅色主题：深蓝色图标在白色工具栏上清晰可见
   - ✅ 深色主题：白色边框在深色工具栏上形成对比

#### **图标制作流程**

1. **SVG设计**: 使用`icons/icon.svg`作为源文件
2. **PNG转换**: 使用rsvg-convert工具生成PNG格式
3. **多尺寸支持**: 生成16x16、32x32、48x48等多种尺寸

```bash
# 生成PNG图标命令示例
rsvg-convert -w 16 -h 16 icons/icon.svg > icons/icon.png
```

#### **未来优化方向**

- **动态图标**: Chrome未来可能支持主题感知图标
- **CSS优化**: 继续优化高对比度设计
- **用户反馈**: 根据用户体验持续改进

## 技术实现

### 核心组件

1. **Background Script**: 监听标签页创建/删除事件，维护标签页关系
2. **Content Script**: 在网页中监听链接点击事件
3. **Popup Interface**: 提供用户交互界面

### 数据存储

使用 Chrome Storage API 存储标签页关系数据：

```javascript
// 数据结构示例
{
  "tabRelations": {
    "123": 456,  // 标签页123的父标签页是456
    "124": 456,  // 标签页124的父标签页是456
    "125": 123   // 标签页125的父标签页是123
  }
}
```

### 权限说明

- `tabs`: 访问标签页信息
- `storage`: 存储标签页关系数据
- `activeTab`: 获取当前活动标签页

## 开发说明

### 调试方法

1. 在 `chrome://extensions/` 页面找到插件
2. 点击"详细信息"
3. 启用"收集错误"
4. 查看控制台输出进行调试

### 修改代码

修改代码后需要：
1. 在扩展程序页面点击刷新按钮
2. 或者重新加载扩展程序

## 注意事项

### 🔒 **权限与隐私**
- **网站访问**: 插件需要在所有网站上运行以跟踪链接点击，这是功能必需的
- **数据隐私**: 所有标签页关系数据仅存储在本地，不会上传到任何服务器
- **权限最小化**: 插件仅请求必要的Chrome API权限，保护用户隐私

### 💾 **数据存储与同步**
- **本地存储**: 标签页关系数据存储在Chrome的本地存储中
- **设备独立**: 数据不会自动同步到其他设备，每台设备独立维护
- **会话持久**: 关闭浏览器后标签页关系数据会保留
- **清理机制**: 可手动清理过期数据，避免存储空间占用过多

### ⚡ **性能考虑**
- **内存使用**: 大量标签页可能会增加内存使用，建议定期清理
- **响应速度**: 插件采用异步处理，不会阻塞页面加载
- **兼容性**: 某些特殊页面（如chrome://）可能无法完全跟踪

### 🔧 **使用限制**
- **系统页面**: Chrome内部页面（扩展管理、设置等）无法被跟踪或关闭
- **权限页面**: 某些需要特殊权限的页面可能无法操作
- **隐私模式**: 隐私模式下的标签页不会与普通模式的标签页建立关系

### 🌐 **浏览器兼容性**
- **Chrome版本**: 需要Chrome 88+版本支持Manifest V3
- **其他浏览器**: 目前仅支持Chrome，未来可能支持Edge等Chromium浏览器
- **移动端**: 暂不支持移动设备上的Chrome

## 故障排除

### 常见问题

1. **树结构不显示**
   - 检查是否有标签页打开
   - 尝试点击刷新按钮

2. **链接跟踪不工作**
   - 确认插件有权限访问当前网站
   - 检查浏览器控制台是否有错误信息

3. **关闭按钮无效**
   - 某些系统标签页（如扩展程序页面）可能无法关闭
   - 尝试刷新树结构

4. **图标显示问题**
   - **图标看不清**: 这是Chrome的主题适配限制，我们已采用高对比度设计
   - **图标缺失**: 检查`icons/`文件夹中是否存在PNG图标文件
   - **图标模糊**: 确保使用了正确尺寸的PNG文件（16x16像素）

### 图标重新生成

如果图标文件损坏或缺失，可以重新生成：

```bash
# 确保安装了rsvg-convert工具
# macOS: brew install librsvg
# Ubuntu: sudo apt-get install librsvg2-bin

# 生成16x16图标
rsvg-convert -w 16 -h 16 icons/icon.svg > icons/icon.png

# 验证文件是否生成成功
ls -la icons/icon.png
```

## 版本信息

- **版本**: 1.0
- **兼容性**: Chrome Manifest V3
- **支持平台**: Windows, macOS, Linux

### 更新日志

#### v1.0 (当前版本)
- ✅ 基本标签页树结构功能
- ✅ 链接跟踪和父子关系建立
- ✅ 批量选择和关闭功能
- ✅ 高对比度图标设计，适配浅色/深色主题
- ✅ 完整的错误处理和用户体验优化

#### 图标优化历程
- **初版**: 基础SVG图标设计
- **优化**: 采用高对比度设计策略
- **当前**: 双层设计，支持主题适配
- **计划**: 等待Chrome原生主题感知图标支持

### 技术债务和改进计划

1. **图标主题适配**: 
   - ⏳ 等待Chrome官方支持动态主题图标
   - 🎯 持续优化高对比度设计

2. **功能增强**:
   - 🔄 标签页会话恢复
   - 🎨 用户界面主题定制
   - 📊 使用统计和分析

3. **性能优化**:
   - ⚡ 大量标签页场景下的性能优化
   - 💾 存储空间优化
