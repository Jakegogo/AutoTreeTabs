# 测试用例.md

## Background - Google OAuth 登录弹窗关闭导致跳转 sibling + relation 丢失（2026-01-12）

### 问题描述
- 打开 Google 账号授权登录弹窗，登录成功后弹窗自动关闭。
- 弹窗关闭后，扩展触发智能切换，错误跳转到 tree 的 sibling（而不是回到弹窗打开前的上一个标签页）。
- 同时，tab 的 relation 关系会短暂丢失，过一会儿又恢复（或出现不稳定的恢复/跳转行为）。

### 复现步骤
1. 在任意正常窗口（normal）中打开一个页面 A。
2. 触发 Google OAuth 授权流程，打开登录弹窗（popup window）。
3. 完成登录，等待登录弹窗自动关闭。

### 预期行为
- 登录弹窗关闭后，应回到弹窗打开前的上一个标签页（浏览器默认行为），不应触发跳转到 sibling。
- tabRelations 不应因 popup window 关闭而被清空，tree 展示/关系不应抖动丢失。

### 实际行为
- 关闭后触发 AutoBackTrack，跳到 sibling。
- window close 触发清空 tabRelations，导致 tree 关系丢失；随后可能又被某些 restore 流程补回或部分重建。

### 验证方法
- **手工验证**：
  - 复现流程后，观察关闭弹窗时是否仍出现 “Activating next tab ... after closing ...” 导致跳 sibling。
  - 打开扩展 popup，确认 tree 关系没有出现 “瞬间变成平铺/关系为 0” 的抖动。
- **关键日志**（期望不再出现/或不再导致副作用）：
  - 不应再在 OAuth popup tab 关闭时触发 sibling 激活。
  - popup window 关闭不应触发全局 tabRelations 清空。

### 测试环境
- OS: macOS (darwin 24.5.0)
- Browser: Chrome（版本以本机为准）
- Extension: AutoTreeTabs

