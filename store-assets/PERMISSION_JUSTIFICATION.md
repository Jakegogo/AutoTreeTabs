# Chrome扩展权限说明文档

## 🔒 **权限列表与用途说明**

本文档详细说明Auto Tree Tabs扩展所需的每个权限及其使用理由，以便Chrome Web Store审核团队了解权限的合理性。

### **核心权限 (Core Permissions)**

#### 1. `"tabs"` - 标签页访问权限
**用途**: 
- 获取所有标签页的基本信息（标题、URL、图标）
- 监听标签页的创建、更新、关闭事件
- 建立标签页之间的父子关系

**必要性**: 这是扩展核心功能，无此权限无法实现标签页树形管理

#### 2. `"activeTab"` - 活动标签页权限  
**用途**:
- 获取当前活动标签页的详细信息
- 与当前标签页进行交互

**必要性**: 用于确定用户当前浏览的页面，建立正确的关系链

#### 3. `"storage"` - 本地存储权限
**用途**:
- 保存标签页关系数据
- 存储用户设置和偏好
- 缓存标签页历史信息

**必要性**: 数据持久化必需，确保浏览器重启后关系不丢失

#### 4. `"scripting"` - 脚本注入权限
**用途**:
- 按需向页面注入内容脚本
- 监听用户的链接点击行为，记录 tab 标签页的打开历史
- 替代 `<all_urls>` 的全局内容脚本

**优势**: 相比 `<all_urls>`，这是一个更安全的替代方案

### **功能增强权限 (Enhanced Features)**

#### 5. `"windows"` - 窗口管理权限
**用途**:
- 获取不同浏览器窗口的标签页信息
- 支持多窗口环境下的标签页管理
- 按窗口组织标签页树结构

**必要性**: 现代用户常使用多窗口，此权限确保功能完整性

#### 6. `"bookmarks"` - 书签权限
**用途**:
- 检查标签页是否已被收藏为书签
- 在界面中显示书签状态图标（★）
- 增强用户对标签页状态的感知

**必要性**: 提供有用的视觉反馈，帮助用户识别重要页面

## 🛡️ **隐私和安全说明**

### **数据收集政策**
- ✅ **仅本地存储**: 所有数据存储在用户本地，无服务器传输
- ✅ **最小权限原则**: 移除了 `<all_urls>` 广泛权限
- ✅ **按需执行**: Content script仅在需要时注入
- ✅ **透明操作**: 所有权限用途公开透明

### **不收集的数据**
- ❌ 用户个人身份信息
- ❌ 浏览历史详细内容  
- ❌ 敏感页面内容
- ❌ 用户输入数据

### **权限使用限制**
- 🔒 仅在HTTP/HTTPS页面注入脚本
- 🔒 不访问系统敏感页面（如chrome://）
- 🔒 不修改页面内容，仅监听点击事件
- 🔒 按需激活，不常驻所有页面

## 📊 **权限优化记录**

### **优化前 (存在审核风险)**
```json
{
  "content_scripts": [
    {
      "matches": ["<all_urls>"],
      "js": ["content.js"]
    }
  ],
  "web_accessible_resources": [
    {
      "matches": ["<all_urls>"]
    }
  ]
}
```

### **优化后 (降低审核风险)**
```json
{
  "permissions": [
    "tabs", "storage", "activeTab", 
    "windows", "bookmarks", "scripting"
  ],
  "content_scripts": [],
  "web_accessible_resources": [
    {
      "matches": ["*://*/*"]
    }
  ]
}
```

### **改进效果**
- ✅ **移除 `<all_urls>`**: 消除广泛主机权限
- ✅ **移除不必要权限**: 删除了 `management` 和 `sessions` 权限
- ✅ **按需注入**: 仅在需要时运行content script
- ✅ **减少资源占用**: 避免在所有页面常驻
- ✅ **提高安全性**: 最小化权限范围

## 🎯 **审核要点说明**

### **为什么需要这些权限**
1. **核心功能实现**: 标签页树形管理需要访问标签页信息
2. **用户体验**: 多窗口支持和会话恢复提升使用体验
3. **数据安全**: 本地存储确保隐私安全
4. **性能优化**: 按需注入减少资源消耗

### **扩展的价值**
- 📈 **效率提升**: 帮助用户管理复杂的标签页关系
- 🧹 **清理工具**: 智能批量关闭相关标签页
- 💾 **数据保护**: 本地化数据存储保护隐私
- 🎓 **学习辅助**: 特别适合研究和学习场景

### **替代方案分析**
- **不使用scripting权限**: 无法监听链接点击，核心功能失效
- **不使用tabs权限**: 无法获取标签页信息，扩展无法工作
- **不使用storage权限**: 无法保存关系数据，用户体验差

## 📝 **总结**

Auto Tree Tabs扩展请求的所有权限都有明确的功能需求和用户价值。我们已经：

1. **移除了高风险权限** (`<all_urls>`)
2. **采用按需注入策略** 减少资源占用
3. **提供完整的权限说明** 确保透明度
4. **遵循最小权限原则** 仅请求必要权限

这些权限的使用完全符合Chrome Web Store的政策要求，旨在为用户提供高效、安全的标签页管理体验。
